<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRM/PM/AI MVP – Multi‑Page Prototype</title>
  <style>
    :root{
      --bg: #ffffff;
      --bg-alt:#f6f3ff; /* soft purple tint */
      --text:#1f1a33;
      --muted:#6b6280;
      --purple:#6b46c1; /* primary purple */
      --purple-600:#5a3aad;
      --purple-100:#efe8ff;
      --card:#ffffff;
      --border:#e8e3f7;
      --success:#16a34a;
      --danger:#ef4444;
      --warning:#f59e0b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--purple);text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      position:sticky;top:0;z-index:50;
      background:linear-gradient(180deg, #6b46c1 0%, #6b46c1 70%, rgba(107,70,193,0.92) 100%);
      color:#fff;box-shadow:0 6px 20px rgba(107,70,193,.18)
    }
    .topbar{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px;padding:14px 20px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.2px}
    .brand-logo{width:28px;height:28px;border-radius:8px;background:#fff;color:var(--purple);display:grid;place-items:center;font-weight:900}
    .topbar nav{margin-left:auto;display:flex;gap:12px;flex-wrap:wrap}
    .nav-btn{background:rgba(255,255,255,.14);color:#fff;border:1px solid rgba(255,255,255,.25);padding:8px 12px;border-radius:10px;cursor:pointer}
    .nav-btn.active{background:#fff;color:var(--purple)}
    .container{max-width:1200px;margin:22px auto;padding:0 20px}
    .hidden{display:none}
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .crm-grid{grid-template-columns:2fr 1fr}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 24px rgba(17,12,34,.06);padding:16px}
    .card h3{margin:0 0 10px 0}
    .btn{background:var(--purple);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--purple);border:1px solid var(--purple)}
    .btn.link{background:transparent;color:var(--purple);border:none;padding:0}
    .input, select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff}
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .table th{color:var(--muted);font-weight:600;text-align:left;padding:6px 8px}
    .table td{background:#fff;border:1px solid var(--border);padding:10px 8px}
    .table td:first-child{border-radius:10px 0 0 10px}
    .table td:last-child{border-radius:0 10px 10px 0}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);background:var(--purple-100);color:var(--purple-600)}
    .kanban{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:12px}
    .column{background:var(--bg-alt);border:1px dashed var(--border);border-radius:12px;padding:10px;min-width:260px}
    .column h4{margin:0 0 8px 0}
    .task{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:8px}
    .subtask{display:flex;align-items:center;gap:8px;margin:6px 0}
    .assistant{background:linear-gradient(180deg,#efe8ff,#fff);border:1px solid var(--border);border-radius:14px;padding:12px}
    .prompt{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;margin:8px 0}
    .prompt:hover{background:var(--purple-100)}
    .kpi{display:flex;align-items:center;justify-content:space-between}
    .mini{font-size:12px;color:var(--muted)}
    .cta-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:14px}
    .cta{background:linear-gradient(180deg,#fff,#efe8ff);border:1px solid var(--border);border-radius:16px;padding:18px;display:flex;flex-direction:column;gap:8px}
    .cta:hover{box-shadow:0 10px 28px rgba(107,70,193,.18)}
    .badge{font-size:11px;background:var(--purple-100);color:var(--purple-600);padding:4px 8px;border-radius:999px;border:1px solid var(--border)}
    .linkrow{display:flex;gap:10px;flex-wrap:wrap}
    .muted{color:var(--muted)}
    .chart{width:100%;height:180px;background:conic-gradient(from 180deg at 50% 50%, #e9e5f7, #efe8ff);border-radius:12px;border:1px solid var(--border);display:grid;place-items:center}
    .checkbox{width:18px;height:18px;border-radius:6px;border:1px solid var(--border);display:inline-grid;place-items:center;cursor:pointer}
    .checkbox.checked{background:var(--purple);color:#fff}
    .checkbox.checked::before{content:'✓'}
    .task.checked .task-title{text-decoration:line-through;color:var(--muted)}
    .notice{background:#f6f3ff;border:1px solid var(--border);padding:10px;border-radius:10px}
    .add-task-row{display:flex;gap:6px;margin-top:8px}
    footer{padding:30px 20px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand"><div class="brand-logo">∑</div> CRM/PM/AI MVP</div>
      <nav id="nav"></nav>
    </div>
  </header>

  <div class="container">
    <!-- COVER (Dashboard) -->
    <section id="page-cover" class="page">
      <div class="grid grid-2">
        <div class="card" style="background:linear-gradient(180deg,#ffffff 0%, #efe8ff 100%)">
          <h2 style="margin:0 0 8px 0">Welcome 👋</h2>
          <p class="muted">Start with the dashboard and jump to any section. This prototype uses a white & purple theme and simulates connections across CRM, Projects, Daily Tasks, Wellness, Insights, and Calendar.</p>
          <div class="notice">Tip: You can edit many fields inline (try double‑clicking table cells), and add new rows using the forms.</div>
          <div style="margin-top:14px" class="linkrow">
            <button class="btn" data-nav="#page-crm">Open CRM Snapshot</button>
            <button class="btn" data-nav="#page-projects">Open Projects + AI</button>
            <button class="btn" data-nav="#page-daily">Open Daily Tasks + Wellness</button>
            <button class="btn" data-nav="#page-insights">Open Insights</button>
            <button class="btn" data-nav="#page-calendar">Open Calendar</button>
          </div>
        </div>
        <div class="card">
          <h3>Quick Links</h3>
          <div class="cta-grid">
            <a class="cta" data-nav="#page-crm"><span class="badge">CRM</span><strong>Clients & Pipeline</strong><span class="mini muted">Manage contacts & stages</span></a>
            <a class="cta" data-nav="#page-projects"><span class="badge">PM + AI</span><strong>Project Tasks & AI</strong><span class="mini muted">Kanban + assistant prompts</span></a>
            <a class="cta" data-nav="#page-daily"><span class="badge">Daily</span><strong>Tasks & Wellness</strong><span class="mini muted">Top 3 + self‑care</span></a>
            <a class="cta" data-nav="#page-insights"><span class="badge">Reports</span><strong>Insights Charts</strong><span class="mini muted">Trends & KPIs</span></a>
            <a class="cta" data-nav="#page-calendar"><span class="badge">Calendar</span><strong>Schedule</strong><span class="mini muted">Google Calendar link</span></a>
          </div>
        </div>
      </div>
    </section>

    <!-- CRM SNAPSHOT -->
    <section id="page-crm" class="page hidden">
      <div class="grid grid-2 crm-grid">
        <div class="card">
          <h3>Clients <span class="pill">Editable</span></h3>
          <input class="input" id="client-search" placeholder="Search clients" style="margin-bottom:8px" />
          <table class="table" id="client-table">
            <thead>
              <tr><th>Name</th><th>Company</th><th>Email</th><th>Phone</th><th>Stage</th><th>Owner</th></tr>
            </thead>
            <tbody>
              <tr>
                <td contenteditable>Alex Rivera</td>
                <td contenteditable>Zenith Group</td>
                <td contenteditable>alex@zenithgrp.com</td>
                <td contenteditable>(404) 555‑0101</td>
                <td contenteditable data-stage>Lead</td>
                <td contenteditable>Nate</td>
              </tr>
              <tr>
                <td contenteditable>Priya Shah</td>
                <td contenteditable>Blue Sky Studio</td>
                <td contenteditable>priya@blueskystudio.io</td>
                <td contenteditable>(470) 555‑0199</td>
                <td contenteditable data-stage>Proposal</td>
                <td contenteditable>Nate</td>
              </tr>
              <tr id="crm-acme">
                <td contenteditable>Jordan Lee</td>
                <td contenteditable>Acme Co.</td>
                <td contenteditable>jordan@acmeco.com</td>
                <td contenteditable>(678) 555‑0147</td>
                <td contenteditable data-stage>Won</td>
                <td contenteditable>Nate</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="card">
          <h3>Add New Client</h3>
          <div class="grid">
            <input class="input" id="new-name" placeholder="Full name" />
            <input class="input" id="new-company" placeholder="Company" />
            <input class="input" id="new-email" placeholder="Email" />
            <input class="input" id="new-phone" placeholder="Phone" />
            <select id="new-stage" class="input">
              <option>Lead</option><option>Discovery</option><option>Proposal</option><option>Negotiation</option><option>Won</option>
            </select>
            <input class="input" id="new-owner" placeholder="Owner" value="Nate" />
            <div class="linkrow">
              <button class="btn" id="add-client">Add Client</button>
              <button class="btn secondary" id="save-crm">Save Changes (Local)</button>
              <button class="btn link" data-nav="#page-cover">Back to Cover</button>
            </div>
          </div>
          <p class="mini muted" style="margin-top:8px">Edits are inline. “Save Changes” stores a local copy in your browser for demo purposes.</p>
        </div>
      </div>
      <div class="card" style="margin-top:16px">
        <h3>Pipeline <span class="badge">Lead → Proposal → Won</span></h3>
        <div class="grid grid-3" id="pipeline">
          <div class="column" data-stage="Lead">
            <h4>Lead</h4>
            <div class="task" draggable="true">Alex Rivera – Zenith Group</div>
          </div>
          <div class="column" data-stage="Proposal">
            <h4>Proposal</h4>
            <div class="task" draggable="true">Priya Shah – Blue Sky Studio</div>
          </div>
          <div class="column" data-stage="Won">
            <h4>Won</h4>
            <div class="task" draggable="true">Jordan Lee – Acme Co.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- PROJECT TASKS + AI ASSISTANT -->
    <section id="page-projects" class="page hidden">
      <div class="grid grid-2">
        <div class="card">
          <h3>Project Tasks (Kanban)</h3>
          <div class="kanban">
            <div class="column" data-status="todo">
              <h4>To Do</h4>
              <div id="todo-list"></div>
              <div class="add-task-row">
                <input class="input" id="todo-new-title" placeholder="Task title" style="flex:2" />
                <input type="date" class="input" id="todo-new-due" style="flex:1" />
                <button class="btn add-task" data-status="todo">Add</button>
              </div>
            </div>
            <div class="column" data-status="progress">
              <h4>In Progress</h4>
              <div id="progress-list"></div>
              <div class="add-task-row">
                <input class="input" id="progress-new-title" placeholder="Task title" style="flex:2" />
                <input type="date" class="input" id="progress-new-due" style="flex:1" />
                <button class="btn add-task" data-status="progress">Add</button>
              </div>
            </div>
            <div class="column" data-status="done">
              <h4>Done</h4>
              <div id="done-list"></div>
              <div class="add-task-row">
                <input class="input" id="done-new-title" placeholder="Task title" style="flex:2" />
                <input type="date" class="input" id="done-new-due" style="flex:1" />
                <button class="btn add-task" data-status="done">Add</button>
              </div>
            </div>
          </div>
        </div>
        <div class="card assistant">
          <h3>AI Assistant (Prompts)</h3>
          <div class="prompt">“Prioritize my tasks for today based on due dates and client impact.”</div>
          <div class="prompt">“Draft a follow‑up email to <em>Priya Shah at Blue Sky Studio</em> about the proposal.”</div>
          <div class="prompt">“Summarize yesterday’s activity for <em>Jordan Lee (Acme Co.)</em> and suggest next steps.”</div>
          <div class="prompt">“Generate 3 wellness nudges for a busy day with back‑to‑back calls.”</div>
          <div class="prompt">“Create a checklist to launch the onboarding flow this week.”</div>
          <div class="notice mini">Non‑functional demo: prompts are static for prototype purposes.</div>
          <div class="linkrow" style="margin-top:8px">
            <button class="btn" data-nav="#page-crm">View CRM</button>
            <button class="btn secondary" data-nav="#page-daily">Go to Daily Tasks</button>
          </div>
        </div>
      </div>
    </section>

    <!-- DAILY TASKS + WELLNESS -->
    <section id="page-daily" class="page hidden">
      <div class="grid grid-2">
        <div class="card">
          <h3>Today’s Top Tasks</h3>
          <div class="task">
            <div style="display:flex;align-items:center;gap:6px;">
              <div class="checkbox"></div>
              <div contenteditable class="task-title">Call: Jordan Lee (Acme Co.)</div>
            </div>
            <div class="mini"><a href="#page-crm" class="crm-link" data-target="crm-acme">Open in CRM</a> • (678) 555‑0147</div>
          </div>
          <div class="task">
            <div style="display:flex;align-items:center;gap:6px;">
              <div class="checkbox"></div>
              <div contenteditable class="task-title">Call: Priya Shah (Blue Sky Studio)</div>
            </div>
            <div class="mini">(470) 555‑0199</div>
          </div>
          <div class="task">
            <div style="display:flex;align-items:center;gap:6px;">
              <div class="checkbox"></div>
              <div contenteditable class="task-title">Call: Alex Rivera (Zenith Group)</div>
            </div>
            <div class="mini">(404) 555‑0101</div>
          </div>
          <div class="task">
            <div style="display:flex;align-items:center;gap:6px;">
              <div class="checkbox"></div>
              <div contenteditable class="task-title">Wellness: Stretch for 5 minutes</div>
            </div>
            <div class="mini muted">Nudge repeats every 90 minutes</div>
          </div>
          <div class="task">
            <div style="display:flex;align-items:center;gap:6px;">
              <div class="checkbox"></div>
              <div contenteditable class="task-title">Wellness: Drink water (250 ml)</div>
            </div>
            <div class="mini muted">Track 8 servings daily</div>
          </div>
          <button class="btn" id="done-day">Mark Done for the Day</button>
        </div>
        <div class="card">
          <h3>Mental Health Trend</h3>
          <div class="mini muted">Self‑reported 1–5 scale • Past 7 days</div>
          <svg viewBox="0 0 320 180" class="chart" aria-label="Mental health chart">
            <polyline points="10,140 55,120 100,100 145,110 190,90 235,80 280,70" fill="none" stroke="#6b46c1" stroke-width="3" />
            <g fill="#6b46c1">
              <circle cx="10" cy="140" r="4"/><circle cx="55" cy="120" r="4"/><circle cx="100" cy="100" r="4"/>
              <circle cx="145" cy="110" r="4"/><circle cx="190" cy="90" r="4"/><circle cx="235" cy="80" r="4"/>
              <circle cx="280" cy="70" r="4"/>
            </g>
          </svg>
          <div class="grid" style="margin-top:10px">
            <select id="mood-today" class="input">
              <option value="5">Today’s mood: 5 (Great)</option>
              <option value="4">4</option>
              <option value="3">3</option>
              <option value="2">2</option>
              <option value="1">1</option>
            </select>
            <button class="btn secondary" id="log-mood">Log Mood (Demo)</button>
          </div>
          <p class="mini muted">This is a visual demo; logging won’t persist beyond this session.</p>
        </div>
      </div>
    </section>

    <!-- INSIGHTS CHARTS -->
    <section id="page-insights" class="page hidden">
      <div class="grid grid-2">
        <div class="card">
          <h3>Overdue Tasks</h3>
          <div id="overdue-count" class="mini" style="color:var(--danger);margin-bottom:8px"></div>
          <div class="chart"></div>
          <ul id="overdue-list" class="mini"></ul>
        </div>
        <div class="card">
          <h3>Completed Tasks</h3>
          <div id="completed-count" class="mini" style="color:var(--success);margin-bottom:8px"></div>
          <div class="chart"></div>
          <ul id="completed-list" class="mini"></ul>
        </div>
      </div>
    </section>

    <!-- CALENDAR -->
    <section id="page-calendar" class="page hidden">
      <div class="grid grid-2">
        <div class="card">
          <h3>Calendar</h3>
          <p class="muted">This prototype links out to Google Calendar for now.</p>
          <a class="btn" href="https://calendar.google.com" target="_blank" rel="noopener">Open Google Calendar</a>
          <p class="mini muted" style="margin-top:8px">In production, this button would use the Google Calendar API to sync events.</p>
        </div>
        <div class="card">
          <h3>Upcoming (Demo)</h3>
          <div id="upcoming-list"></div>
          <div class="add-task-row">
            <input class="input" id="upcoming-title" placeholder="Event title" style="flex:2" />
            <input type="datetime-local" class="input" id="upcoming-date" style="flex:1" />
            <button class="btn" id="add-upcoming">Add</button>
          </div>
        </div>
      </div>
    </section>

    <!-- TASK DETAIL MODAL -->
    <section id="task-modal" class="hidden" aria-hidden="true">
      <div style="position:fixed;inset:0;background:rgba(31,26,51,.66);display:grid;place-items:center;z-index:1000">
        <div class="card" style="max-width:360px;text-align:center">
          <h3 id="modal-title"></h3>
          <p class="mini">Due: <span id="modal-due"></span></p>
          <button class="btn secondary" id="modal-close">Close</button>
        </div>
      </div>
    </section>

    <!-- DONE OVERLAY (demo) -->
    <section id="overlay-done" class="hidden" aria-hidden="true">
      <div style="position:fixed;inset:0;background:rgba(31,26,51,.66);display:grid;place-items:center;z-index:1000">
        <div class="card" style="max-width:440px;text-align:center;border:2px solid var(--purple)">
          <h2>You're done for today 🎉</h2>
          <p class="muted">Great work. Tasks complete and wellness goals met.</p>
          <button class="btn" id="close-done">Close</button>
        </div>
      </div>
    </section>

  </div>

  <footer>
    Prototype only. Data is local to the browser and not persisted to a server.
  </footer>

  <script>
    // Navigation builder
    const pages = [
      { id:'#page-cover', label:'Dashboard' },
      { id:'#page-crm', label:'CRM Snapshot' },
      { id:'#page-projects', label:'Projects + AI' },
      { id:'#page-daily', label:'Daily + Wellness' },
      { id:'#page-insights', label:'Insights' },
      { id:'#page-calendar', label:'Calendar' }
    ];
    const nav = document.getElementById('nav');
    pages.forEach(p=>{
      const b=document.createElement('button');
      b.className='nav-btn'; b.textContent=p.label; b.dataset.nav=p.id; nav.appendChild(b);
    });

    function showPage(hash){
      document.querySelectorAll('.page').forEach(el=>el.classList.add('hidden'));
      const target = document.querySelector(hash || '#page-cover');
      if(target){ target.classList.remove('hidden'); }
      document.querySelectorAll('.nav-btn').forEach(btn=>{
        btn.classList.toggle('active', btn.dataset.nav===hash);
      });
      history.replaceState(null, '', hash || '#page-cover');
    }

    document.addEventListener('click', (e)=>{
      const navTo = e.target.closest('[data-nav]');
      if(navTo){ e.preventDefault(); showPage(navTo.dataset.nav); }
      const crmLink = e.target.closest('.crm-link');
      if(crmLink){ e.preventDefault(); showPage('#page-crm');
        const rowId = crmLink.dataset.target;
        const row = document.getElementById(rowId);
        if(row){ row.scrollIntoView({behavior:'smooth', block:'center'}); row.style.outline='2px solid var(--purple)'; setTimeout(()=>row.style.outline='none', 1800); }
      }
    });

    // On load
    showPage(location.hash || '#page-cover');

    // CRM: Add + Save (localStorage)
    const addBtn = document.getElementById('add-client');
    const saveBtn = document.getElementById('save-crm');
    const table = document.getElementById('client-table').querySelector('tbody');
    const searchInput = document.getElementById('client-search');
    function getVal(id){ return document.getElementById(id).value.trim(); }
    if(addBtn){
      addBtn.addEventListener('click', ()=>{
        const name=getVal('new-name'); const comp=getVal('new-company'); const email=getVal('new-email'); const phone=getVal('new-phone'); const stage=getVal('new-stage'); const owner=getVal('new-owner');
        if(!name||!comp){ alert('Name and Company are required.'); return; }
        const tr=document.createElement('tr');
        tr.innerHTML=`<td contenteditable>${name}</td><td contenteditable>${comp}</td><td contenteditable>${email}</td><td contenteditable>${phone}</td><td contenteditable data-stage>${stage}</td><td contenteditable>${owner}</td>`;
        table.appendChild(tr);
        ['new-name','new-company','new-email','new-phone','new-owner'].forEach(id=>document.getElementById(id).value='');
      });
    }
    function serializeCRM(){
      return [...table.querySelectorAll('tr')].map(tr=>[...tr.children].map(td=>td.textContent));
    }
    if(searchInput){
      searchInput.addEventListener('input', ()=>{
        const q = searchInput.value.toLowerCase();
        [...table.querySelectorAll('tr')].forEach(tr=>{
          const match = [...tr.children].some(td=>td.textContent.toLowerCase().includes(q));
          tr.style.display = match ? '' : 'none';
        });
      });
    }
    if(saveBtn){
      saveBtn.addEventListener('click', ()=>{
        const data = serializeCRM();
        localStorage.setItem('crm-demo', JSON.stringify(data));
        alert('Saved locally for demo.');
      });
      // Load on init if present
      const saved = localStorage.getItem('crm-demo');
      if(saved){
        try{
          const rows = JSON.parse(saved);
          table.innerHTML='';
          rows.forEach(cols=>{
            const tr=document.createElement('tr');
            tr.innerHTML = cols.map((v,i)=>`<td contenteditable ${i===4? 'data-stage':''}>${v}</td>`).join('');
            table.appendChild(tr);
          })
        }catch(err){ console.warn('Failed to parse saved CRM data', err); }
      }
    }

    // Project Tasks (Kanban)
    const taskColumns = {
      todo: document.getElementById('todo-list'),
      progress: document.getElementById('progress-list'),
      done: document.getElementById('done-list')
    };
    let tasks = [];
    function loadTasks(){
      const saved = localStorage.getItem('kanban-tasks');
      if(saved){
        try{ tasks = JSON.parse(saved); }catch(e){ tasks = []; }
      }
      if(!tasks.length){
        tasks = [
          {id:1,title:'Launch Onboarding Flow',due:'2024-09-05',status:'todo',checked:false},
          {id:2,title:'Proposal for Blue Sky Studio',due:'2024-08-28',status:'progress',checked:false},
          {id:3,title:'Kickoff – Acme Co.',due:'2024-08-20',status:'done',checked:true}
        ];
      }
      tasks = tasks.map(t=>({...t,checked:!!t.checked}));
    }
    function saveTasks(){ localStorage.setItem('kanban-tasks', JSON.stringify(tasks)); }
    function renderTasks(){
      Object.values(taskColumns).forEach(col=>col.innerHTML='');
      tasks.forEach(t=>{
        const col = taskColumns[t.status];
        if(!col) return;
        const div = document.createElement('div');
        div.className = 'task'+(t.checked?' checked':'');
        div.dataset.id = t.id;
        div.draggable = true;
        div.innerHTML = `<div style="display:flex;align-items:center;gap:6px;"><div class="checkbox ${t.checked?'checked':''}" data-check></div><div contenteditable class="task-title">${t.title}</div></div><div class="mini">Due: <span contenteditable class="task-due">${t.due||''}</span></div>`;
        col.appendChild(div);
      });
      updateInsights();
    }
    function addTask(status,title,due){
      const id = Date.now();
      tasks.push({id,title,due,status,checked:status==='done'});
      saveTasks();
      renderTasks();
    }
    document.querySelectorAll('.add-task').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const status = btn.dataset.status;
        const title = document.getElementById(`${status}-new-title`).value.trim();
        const due = document.getElementById(`${status}-new-due`).value;
        if(!title) return;
        addTask(status,title,due);
        document.getElementById(`${status}-new-title`).value='';
        document.getElementById(`${status}-new-due`).value='';
      });
    });
    document.addEventListener('blur', (e)=>{
      const taskEl = e.target.closest('.task');
      if(!taskEl) return;
      const id = Number(taskEl.dataset.id);
      const task = tasks.find(t=>t.id===id);
      if(!task) return;
      task.title = taskEl.querySelector('.task-title').textContent.trim();
      task.due = taskEl.querySelector('.task-due').textContent.trim();
      saveTasks();
      updateInsights();
    }, true);
    document.addEventListener('click', (e)=>{
      const box = e.target.closest('.checkbox');
      if(!box) return;
      const taskEl = box.closest('.task');
      const id = Number(taskEl.dataset.id);
      const task = tasks.find(t=>t.id===id);
      if(task){
        task.checked = !task.checked;
        box.classList.toggle('checked', task.checked);
        taskEl.classList.toggle('checked', task.checked);
        saveTasks();
        updateInsights();
      }else{
        const isChecked = box.classList.toggle('checked');
        taskEl.classList.toggle('checked', isChecked);
      }
    });
    function updateInsights(){
      const today = new Date().toISOString().split('T')[0];
      const overdue = tasks.filter(t=>!t.checked && t.due && t.due<today);
      const completed = tasks.filter(t=>t.checked);
      const overdueList = document.getElementById('overdue-list');
      const completedList = document.getElementById('completed-list');
      const overdueCount = document.getElementById('overdue-count');
      const completedCount = document.getElementById('completed-count');
      if(overdueCount){ overdueCount.textContent = `${overdue.length} overdue`; }
      if(completedCount){ completedCount.textContent = `${completed.length} completed`; }
      if(overdueList){
        overdueList.innerHTML = overdue.length ? overdue.map(t=>`<li>${t.title} (Due: ${t.due})</li>`).join('') : '<li>None</li>';
      }
      if(completedList){
        completedList.innerHTML = completed.length ? completed.map(t=>`<li>${t.title}</li>`).join('') : '<li>None</li>';
      }
    }
    loadTasks();
    renderTasks();

    // Kanban drag and drop
    let draggedTaskId = null;
    let draggedPerson = null;
    document.addEventListener('dragstart', e=>{
      const taskEl = e.target.closest('.task');
      if(taskEl && taskEl.dataset.id){ draggedTaskId = Number(taskEl.dataset.id); }
      if(taskEl && taskEl.closest('#pipeline')){ draggedPerson = taskEl; }
    });
    document.querySelectorAll('.kanban .column').forEach(col=>{
      col.addEventListener('dragover', e=>e.preventDefault());
      col.addEventListener('drop', e=>{
        e.preventDefault();
        if(draggedTaskId!==null){
          const newStatus = col.dataset.status;
          const task = tasks.find(t=>t.id===draggedTaskId);
          if(task && newStatus){ task.status = newStatus; saveTasks(); renderTasks(); }
        }
      });
    });

    // Pipeline drag and drop
    document.querySelectorAll('#pipeline .task').forEach(t=>{
      t.addEventListener('dragstart', ()=> draggedPerson = t);
    });
    document.querySelectorAll('#pipeline .column').forEach(col=>{
      col.addEventListener('dragover', e=>e.preventDefault());
      col.addEventListener('drop', ()=>{
        if(draggedPerson){ col.appendChild(draggedPerson); draggedPerson=null; }
      });
    });

    // Calendar upcoming items
    const upcomingList = document.getElementById('upcoming-list');
    let upcoming = [];
    function loadUpcoming(){
      const saved = localStorage.getItem('calendar-upcoming');
      if(saved){ try{ upcoming = JSON.parse(saved); }catch{ upcoming=[]; } }
      if(!upcoming.length){
        upcoming = [
          {title:'Client Call – Acme Co.', time:'Sep 2, 10:00'},
          {title:'Proposal Review – Blue Sky', time:'Sep 3, 14:00'},
          {title:'Onboarding Session', time:'Sep 5, 09:00'}
        ];
      }
    }
    function saveUpcoming(){ localStorage.setItem('calendar-upcoming', JSON.stringify(upcoming)); }
    function renderUpcoming(){
      if(!upcomingList) return;
      upcomingList.innerHTML='';
      upcoming.forEach((u,i)=>{
        const div=document.createElement('div');
        div.className='task';
        div.dataset.index=i;
        div.innerHTML=`<div contenteditable class="task-title">${u.title}</div><div class="mini" contenteditable>${u.time}</div><button class="btn link remove-upcoming">Remove</button>`;
        upcomingList.appendChild(div);
      });
    }
    const addUpcoming=document.getElementById('add-upcoming');
    if(addUpcoming){
      addUpcoming.addEventListener('click',()=>{
        const title=document.getElementById('upcoming-title').value.trim();
        const date=document.getElementById('upcoming-date').value;
        if(!title) return;
        const time=date? new Date(date).toLocaleString():'';
        upcoming.push({title,time});
        saveUpcoming(); renderUpcoming();
        document.getElementById('upcoming-title').value='';
        document.getElementById('upcoming-date').value='';
      });
    }
    if(upcomingList){
      upcomingList.addEventListener('click',e=>{
        if(e.target.closest('.remove-upcoming')){
          const idx=Number(e.target.closest('.task').dataset.index);
          upcoming.splice(idx,1); saveUpcoming(); renderUpcoming();
        }
      });
      upcomingList.addEventListener('blur',e=>{
        const item=e.target.closest('.task');
        if(!item) return;
        const idx=Number(item.dataset.index);
        upcoming[idx].title=item.querySelector('.task-title').textContent.trim();
        upcoming[idx].time=item.querySelector('.mini').textContent.trim();
        saveUpcoming();
      },true);
    }
    loadUpcoming(); renderUpcoming();

    // Task detail modal
    const taskModal = document.getElementById('task-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalDue = document.getElementById('modal-due');
    const modalClose = document.getElementById('modal-close');
    if(taskModal){
      taskModal.addEventListener('click', e=>{
        if(e.target===taskModal.firstElementChild){ taskModal.classList.add('hidden'); }
      });
    }
    if(modalClose){ modalClose.addEventListener('click',()=> taskModal.classList.add('hidden')); }
    document.addEventListener('click', e=>{
      if(e.target.closest('.checkbox')||e.target.closest('.remove-upcoming')||e.target.hasAttribute('contenteditable')||e.target.closest('[contenteditable]')||e.target.tagName==='A') return;
      const taskEl = e.target.closest('.task');
      if(!taskEl || taskEl.closest('#task-modal')) return;
      let title='', due='';
      if(taskEl.dataset.id){
        const t = tasks.find(x=>x.id===Number(taskEl.dataset.id));
        if(t){ title=t.title; due=t.due||''; }
      }else if(taskEl.closest('#upcoming-list')){
        title = taskEl.querySelector('.task-title').textContent.trim();
        due = taskEl.querySelector('.mini').textContent.trim();
      }else if(taskEl.closest('#page-daily')){
        title = taskEl.querySelector('.task-title')?taskEl.querySelector('.task-title').textContent.trim():taskEl.textContent.trim();
        due = taskEl.querySelector('.mini')?taskEl.querySelector('.mini').textContent.trim():'';
      }else if(taskEl.closest('#pipeline')){
        title = taskEl.textContent.trim();
        due = taskEl.parentElement.dataset.stage || '';
      }
      if(title){
        modalTitle.textContent=title;
        modalDue.textContent=due;
        taskModal.classList.remove('hidden');
      }
    });

    document.querySelectorAll('.prompt').forEach(p=>{
      p.style.cursor='pointer';
      p.addEventListener('click',()=>{
        const txt = p.textContent.replace(/[“”]/g,'').trim();
        window.open('https://chat.openai.com/?q='+encodeURIComponent(txt),'_blank');
      });
    });

    // Done for the Day overlay
    const doneBtn = document.getElementById('done-day');
    const overlay = document.getElementById('overlay-done');
    const closeDone = document.getElementById('close-done');
    if(doneBtn){ doneBtn.addEventListener('click', ()=> overlay.classList.remove('hidden')); }
    if(closeDone){ closeDone.addEventListener('click', ()=> overlay.classList.add('hidden')); }
  </script>
</body>
</html>
